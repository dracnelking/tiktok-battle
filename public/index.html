<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TikTok Colosseum Battle</title>
    <style>
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            font-family: 'Arial Black', sans-serif;
        }

        /* --- VIDEO DE FONDO --- */
        #bg-video {
            position: fixed;
            top: 50%; left: 50%;
            min-width: 100%; min-height: 100%;
            width: auto; height: auto;
            z-index: -10;
            transform: translateX(-50%) translateY(-50%);
            background-size: cover;
        }

        /* --- UI GENERAL --- */
        /* Estilos visuales compartidos */
        .victory-style {
            position: absolute; 
            /* CAMBIO: Usamos vw (viewport width) para que el texto escale con la ventana */
            font-size: 3vw; 
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            /* CAMBIO: Z-index bajo para que el pilar pase por encima */
            z-index: 5; 
        }

        .percent-style {
            position: absolute;
            /* CAMBIO: Texto escalable */
            font-size: 5vw; 
            color: white;
            text-shadow: 3px 3px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            /* CAMBIO: Z-index bajo */
            z-index: 5;
            line-height: 1;
        }

        /* ==================================================================
           POSICIONES (Mantenemos los porcentajes, que ya son adaptables)
           ================================================================== */

        /* Victorias */
        #girl-wins-box { top: 36%; left: 10%; }
        #boy-wins-box { top: 36%; right: 10%; }

        /* Porcentajes */
        #girl-percent-box {
            top: 25%; left: 35%; 
            transform: translateX(-50%);
        }
        #boy-percent-box {
            top: 25%; right: 35%;
            transform: translateX(50%);
        }

        /* ================================================================== */


        /* --- EL CENTRO MÓVIL (Pilar + Personajes) --- */
        #movable-center {
            position: absolute;
            /* Posición vertical relativa */
            top: 65%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            transition: left 0.3s ease-out; 
            
            /* CAMBIO: Z-index muy alto (50) para estar SIEMPRE ENCIMA de los textos (5) */
            z-index: 50; 
            
            display: flex; 
            align-items: flex-end; 
            justify-content: center;
            position: relative; 
            width: 10px; height: 10px;
            
            /* Eliminamos margin-top fijo en px para evitar desajustes */
            margin-top: 0; 
        }

        #center-pilar {
            /* CAMBIO: Altura en vh (60% de la altura de la pantalla) */
            height: 60vh; 
            width: auto;
            z-index: 52; 
            margin-bottom: -4vh; /* Ajuste relativo */
        }

        .character-img {
            position: absolute;
            /* CAMBIO: Altura en vh (30% de la altura de la pantalla) */
            height: 30vh; 
            bottom: -4vh; /* Ajuste relativo */
        }

        #girl-char { right: 4vh; z-index: 51; } /* Separación relativa */
        #boy-char { left: 4vh; z-index: 51; }


        /* --- PANTALLA DE VICTORIA --- */
        #winner-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; flex-direction: column; 
            justify-content: center; align-items: center;
            z-index: 100; color: gold; text-align: center;
        }
        #winner-overlay h1 { font-size: 8vw; margin: 0; text-transform: uppercase; text-shadow: 0 0 20px gold;}
    </style>
</head>
<body>

    <video autoplay muted loop id="bg-video">
        <source src="image/romano.mp4" type="video/mp4">
    </video>

    <div id="winner-overlay">
        <h1 id="winner-text">WINNER!</h1>
        <p style="color:white; font-size: 2vw">Reiniciando...</p>
    </div>

    <div id="game-arena">
        
        <div id="girl-wins-box" class="victory-style">
            <span id="girl-wins">0</span>
        </div>

        <div id="boy-wins-box" class="victory-style">
            <span id="boy-wins">0</span>
        </div>

        <div id="girl-percent-box" class="percent-style">
            <span id="girl-percent-txt">50</span>%
        </div>

        <div id="boy-percent-box" class="percent-style">
            <span id="boy-percent-txt">50</span>%
        </div>


        <div id="movable-center">
            <img src="image/tralacut.png" id="girl-char" class="character-img" alt="Girl">
            <img src="image/pilar.png" id="center-pilar" alt="Pilar">
            <img src="image/tungcut.png" id="boy-char" class="character-img" alt="Boy">
        </div>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        const params = new URLSearchParams(window.location.search);
        const username = params.get('username') || 'TU_USUARIO_AQUI'; 

        if(username && username !== 'TU_USUARIO_AQUI') {
            socket.emit('setTiktokUser', username);
            console.log("Conectando a:", username);
        }

        let currentPosition = 50; 
        let girlWinsCount = 0;
        let boyWinsCount = 0;
        let isGameOver = false;

        const movableCenter = document.getElementById('movable-center');
        const girlPercentTxt = document.getElementById('girl-percent-txt');
        const boyPercentTxt = document.getElementById('boy-percent-txt');
        const girlWinsTxt = document.getElementById('girl-wins');
        const boyWinsTxt = document.getElementById('boy-wins');
        const winnerOverlay = document.getElementById('winner-overlay');
        const winnerText = document.getElementById('winner-text');

        socket.on('gameUpdate', (data) => {
            if(isGameOver) return;

            if (data.team === 'girl') {
                currentPosition += data.power;
            } else {
                currentPosition -= data.power;
            }
            updateScreen();
        });

        function updateScreen() {
            if (currentPosition > 100) currentPosition = 100;
            if (currentPosition < 0) currentPosition = 0;

            movableCenter.style.left = currentPosition + '%';
            
            girlPercentTxt.innerText = Math.round(currentPosition);
            boyPercentTxt.innerText = Math.round(100 - currentPosition);

            checkWin();
        }

        function checkWin() {
            if (currentPosition >= 100) {
                girlWinsCount++;
                girlWinsTxt.innerText = girlWinsCount;
                doWin("GIRLS WIN!", "#ff85c0");
            } else if (currentPosition <= 0) {
                boyWinsCount++;
                boyWinsTxt.innerText = boyWinsCount;
                doWin("BOYS WIN!", "#4facfe");
            }
        }

        function doWin(text, color) {
            isGameOver = true;
            winnerText.innerText = text;
            winnerText.style.color = color;
            winnerOverlay.style.display = 'flex';

            setTimeout(() => {
                currentPosition = 50;
                updateScreen();
                winnerOverlay.style.display = 'none';
                isGameOver = false;
            }, 4000); 
        }
    </script>
</body>
</html>
