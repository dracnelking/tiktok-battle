<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TikTok Colosseum Battle</title>
    <style>
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            font-family: 'Arial Black', sans-serif;
        }

        /* --- VIDEO DE FONDO --- */
        #bg-video {
            position: fixed;
            top: 50%; left: 50%;
            min-width: 100%; min-height: 100%;
            width: auto; height: auto;
            z-index: -10;
            transform: translateX(-50%) translateY(-50%);
            background-size: cover;
        }

        /* --- ARENA DE JUEGO --- */
        #game-arena {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0); 
        }

        /* --- UI SUPERIOR (Contadores y Porcentajes) --- */
        .team-ui {
            position: absolute;
            top: 0; /* Empezamos desde arriba del todo */
            width: 300px; /* Ancho fijo para controlar mejor el centro */
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 20;
        }

        /* AJUSTE HORIZONTAL DE LOS EQUIPOS */
        /* Los movemos más a los extremos como pediste */
        #girl-ui { left: 5%; } 
        #boy-ui { right: 5%; }

        .team-name { 
            font-size: 1.2rem; 
            color: gold; 
            margin-top: 50px;
            text-align: center;
        }

        /* --- CAJA DE VICTORIAS --- */
        .victory-box {
            /* AJUSTE VERTICAL SOLICITADO */
            margin-top: 70px; 
            font-size: 2.5rem; /* Número de victorias más grande */
            font-weight: bold;
        }

        /* --- PORCENTAJE --- */
        .big-percent {
            font-size: 5rem; 
            margin: 100px 0 0 0; /* Un poco de espacio respecto a las victorias */
            line-height: 1;
            /* Ahora está DEBAJO de las victorias visualmente */
        }
        

        /* --- EL CENTRO MÓVIL (Pilar + Personajes) --- */
        #movable-center {
            position: absolute;
            /* AJUSTE DE ALTURA DE PERSONAJES: Bajado al 70% */
            top: 70%; 
            
            left: 50%; 
            transform: translate(-50%, -50%); 
            transition: left 0.3s ease-out; 
            z-index: 10;
            display: flex; 
            align-items: flex-end; /* Alineados abajo */
            justify-content: center;
            position: relative; 
            width: 10px;
            height: 10px;
            margin-top: 140px; 
        }

        /* El Pilar Central */
        #center-pilar {
            /* AJUSTE DE TAMAÑO PILAR: Mucho más grande */
            height: 600px; 
            width: auto;
            z-index: 12; 
            margin-bottom: -50px; /* Ajuste fino para que pise el suelo bien */
        }

        /* Estilos comunes para los personajes */
        .character-img {
            position: absolute;
            height: 300px; 
            bottom: -50px; /* Ajuste para alinear pies con el pilar */
        }

        #girl-char {
            right: 40px; /* Separación del pilar */
            z-index: 11;
        }

        #boy-char {
            left: 40px; /* Separación del pilar */
            z-index: 11;
        }


        /* --- PANTALLA DE VICTORIA --- */
        #winner-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; flex-direction: column; 
            justify-content: center; align-items: center;
            z-index: 100; color: gold; text-align: center;
        }
        #winner-overlay h1 { font-size: 6rem; margin: 0; text-transform: uppercase; text-shadow: 0 0 20px gold;}
    </style>
</head>
<body>

    <video autoplay muted loop id="bg-video">
        <source src="image/romano.mp4" type="video/mp4">
    </video>

    <div id="winner-overlay">
        <h1 id="winner-text">WINNER!</h1>
        <p style="color:white; font-size: 2rem">Reiniciando...</p>
    </div>

    <div id="game-arena">
        
        <div id="girl-ui" class="team-ui">
             <div class="team-name">TEAM Tralalero Tralala</div>
             
             <div class="victory-box"><span id="girl-wins">0</span></div>
             
             <h2 class="big-percent"><span id="girl-percent-txt">50</span>%</h2>
        </div>

        <div id="boy-ui" class="team-ui">
             <div class="team-name">TEAM Tung Tung Tung Shaur</div>
             
             <div class="victory-box"><span id="boy-wins">0</span></div>
             
             <h2 class="big-percent"><span id="boy-percent-txt">50</span>%</h2>
        </div>


        <div id="movable-center">
            <img src="image/tralacut.png" id="girl-char" class="character-img" alt="Girl">
            
            <img src="image/pilar.png" id="center-pilar" alt="Pilar">
            
            <img src="image/tungcut.png" id="boy-char" class="character-img" alt="Boy">
        </div>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        const params = new URLSearchParams(window.location.search);
        const username = params.get('username') || 'TU_USUARIO_AQUI'; 

        if(username && username !== 'TU_USUARIO_AQUI') {
            socket.emit('setTiktokUser', username);
            console.log("Conectando a:", username);
        }

        let currentPosition = 50; 
        let girlWinsCount = 0;
        let boyWinsCount = 0;
        let isGameOver = false;

        const movableCenter = document.getElementById('movable-center');
        const girlPercentTxt = document.getElementById('girl-percent-txt');
        const boyPercentTxt = document.getElementById('boy-percent-txt');
        const girlWinsTxt = document.getElementById('girl-wins');
        const boyWinsTxt = document.getElementById('boy-wins');
        const winnerOverlay = document.getElementById('winner-overlay');
        const winnerText = document.getElementById('winner-text');

        socket.on('gameUpdate', (data) => {
            if(isGameOver) return;

            if (data.team === 'girl') {
                currentPosition += data.power;
            } else {
                currentPosition -= data.power;
            }
            updateScreen();
        });

        function updateScreen() {
            if (currentPosition > 100) currentPosition = 100;
            if (currentPosition < 0) currentPosition = 0;

            movableCenter.style.left = currentPosition + '%';
            
            girlPercentTxt.innerText = Math.round(currentPosition);
            boyPercentTxt.innerText = Math.round(100 - currentPosition);

            checkWin();
        }

        function checkWin() {
            if (currentPosition >= 100) {
                girlWinsCount++;
                girlWinsTxt.innerText = girlWinsCount;
                doWin("GIRLS WIN!", "#ff85c0");
            } else if (currentPosition <= 0) {
                boyWinsCount++;
                boyWinsTxt.innerText = boyWinsCount;
                doWin("BOYS WIN!", "#4facfe");
            }
        }

        function doWin(text, color) {
            isGameOver = true;
            winnerText.innerText = text;
            winnerText.style.color = color;
            winnerOverlay.style.display = 'flex';

            setTimeout(() => {
                currentPosition = 50;
                updateScreen();
                winnerOverlay.style.display = 'none';
                isGameOver = false;
            }, 4000); 
        }
    </script>
</body>
</html>
