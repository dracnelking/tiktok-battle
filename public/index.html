<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TikTok Colosseum Battle</title>
    <style>
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            font-family: 'Arial Black', sans-serif;
        }

        /* --- VIDEO DE FONDO --- */
        #bg-video {
            position: fixed;
            top: 50%; left: 50%;
            min-width: 100%; min-height: 100%;
            width: auto; height: auto;
            z-index: -10;
            transform: translateX(-50%) translateY(-50%);
            background-size: cover;
        }

        /* --- UI GENERAL --- */
        /* Estilos visuales compartidos (Color, borde, fuente) */
        .victory-style {
            position: absolute; 
            font-size: 3rem; 
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 20;
            /* Quitamos el borde y fondo para que parezca que el número está pintado en la piedra */
            /* Si quieres caja negra, descomenta las líneas de abajo: */
            /* background: rgba(0,0,0,0.5); padding: 5px 20px; border-radius: 10px; */
        }

        .percent-style {
            position: absolute;
            font-size: 5rem; 
            color: white;
            text-shadow: 3px 3px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            z-index: 20;
            line-height: 1;
        }

        /* ==================================================================
           AQUÍ ES DONDE AJUSTAS LAS POSICIONES INDEPENDIENTEMENTE
           ================================================================== */

        /* --- 1. VICTORIAS CHICA (Izquierda) --- */
        /* Ajusta 'top' y 'left' para que caiga dentro del rectángulo de piedra izquierdo */
        #girl-wins-box {
            top: 36%;  /* Altura aproximada del rectángulo */
            left: 14%; /* Distancia desde la izquierda */
        }

        /* --- 2. VICTORIAS CHICO (Derecha) --- */
        /* Ajusta 'top' y 'right' para que caiga dentro del rectángulo de piedra derecho */
        #boy-wins-box {
            top: 36%;   /* Altura aproximada del rectángulo */
            right: 14%; /* Distancia desde la derecha */
        }

        /* --- 3. PORCENTAJE CHICA --- */
        /* Lo acercamos al centro (cerca del pilar) */
        #girl-percent-box {
            top: 45%;   /* Altura */
            left: 38%;  /* 38% desde la izquierda (casi al centro) */
            transform: translateX(-50%); /* Para centrarlo mejor */
        }

        /* --- 4. PORCENTAJE CHICO --- */
        /* Lo acercamos al centro (cerca del pilar) */
        #boy-percent-box {
            top: 45%;   /* Altura */
            right: 38%; /* 38% desde la derecha (casi al centro) */
            transform: translateX(50%);
        }

        /* ================================================================== */


        /* --- NOMBRES DE EQUIPO (Opcional, si quieres volver a ponerlos) --- */
        .team-name {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            font-size: 1.5rem; color: gold; 
            text-shadow: 2px 2px 4px #000;
            z-index: 15;
            display: none; /* Oculto por ahora según tu última imagen */
        }


        /* --- EL CENTRO MÓVIL (Pilar + Personajes) --- */
        #movable-center {
            position: absolute;
            top: 70%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            transition: left 0.3s ease-out; 
            z-index: 10;
            display: flex; 
            align-items: flex-end; 
            justify-content: center;
            position: relative; 
            width: 10px; height: 10px;
            margin-top: 100px; /* Ajustado para que no estén tan abajo */
        }

        #center-pilar {
            height: 600px; 
            width: auto;
            z-index: 12; 
            margin-bottom: -50px; 
        }

        .character-img {
            position: absolute;
            height: 300px; 
            bottom: -50px; 
        }

        #girl-char { right: 40px; z-index: 11; }
        #boy-char { left: 40px; z-index: 11; }


        /* --- PANTALLA DE VICTORIA --- */
        #winner-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; flex-direction: column; 
            justify-content: center; align-items: center;
            z-index: 100; color: gold; text-align: center;
        }
        #winner-overlay h1 { font-size: 6rem; margin: 0; text-transform: uppercase; text-shadow: 0 0 20px gold;}
    </style>
</head>
<body>

    <video autoplay muted loop id="bg-video">
        <source src="image/romano.mp4" type="video/mp4">
    </video>

    <div id="winner-overlay">
        <h1 id="winner-text">WINNER!</h1>
        <p style="color:white; font-size: 2rem">Reiniciando...</p>
    </div>

    <div id="game-arena">
        
        <div id="girl-wins-box" class="victory-style">
            <span id="girl-wins">0</span>
        </div>

        <div id="boy-wins-box" class="victory-style">
            <span id="boy-wins">0</span>
        </div>

        <div id="girl-percent-box" class="percent-style">
            <span id="girl-percent-txt">50</span>%
        </div>

        <div id="boy-percent-box" class="percent-style">
            <span id="boy-percent-txt">50</span>%
        </div>


        <div id="movable-center">
            <img src="image/tralacut.png" id="girl-char" class="character-img" alt="Girl">
            <img src="image/pilar.png" id="center-pilar" alt="Pilar">
            <img src="image/tungcut.png" id="boy-char" class="character-img" alt="Boy">
        </div>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        const params = new URLSearchParams(window.location.search);
        const username = params.get('username') || 'TU_USUARIO_AQUI'; 

        if(username && username !== 'TU_USUARIO_AQUI') {
            socket.emit('setTiktokUser', username);
            console.log("Conectando a:", username);
        }

        let currentPosition = 50; 
        let girlWinsCount = 0;
        let boyWinsCount = 0;
        let isGameOver = false;

        const movableCenter = document.getElementById('movable-center');
        const girlPercentTxt = document.getElementById('girl-percent-txt');
        const boyPercentTxt = document.getElementById('boy-percent-txt');
        const girlWinsTxt = document.getElementById('girl-wins');
        const boyWinsTxt = document.getElementById('boy-wins');
        const winnerOverlay = document.getElementById('winner-overlay');
        const winnerText = document.getElementById('winner-text');

        socket.on('gameUpdate', (data) => {
            if(isGameOver) return;

            if (data.team === 'girl') {
                currentPosition += data.power;
            } else {
                currentPosition -= data.power;
            }
            updateScreen();
        });

        function updateScreen() {
            if (currentPosition > 100) currentPosition = 100;
            if (currentPosition < 0) currentPosition = 0;

            movableCenter.style.left = currentPosition + '%';
            
            girlPercentTxt.innerText = Math.round(currentPosition);
            boyPercentTxt.innerText = Math.round(100 - currentPosition);

            checkWin();
        }

        function checkWin() {
            if (currentPosition >= 100) {
                girlWinsCount++;
                girlWinsTxt.innerText = girlWinsCount;
                doWin("GIRLS WIN!", "#ff85c0");
            } else if (currentPosition <= 0) {
                boyWinsCount++;
                boyWinsTxt.innerText = boyWinsCount;
                doWin("BOYS WIN!", "#4facfe");
            }
        }

        function doWin(text, color) {
            isGameOver = true;
            winnerText.innerText = text;
            winnerText.style.color = color;
            winnerOverlay.style.display = 'flex';

            setTimeout(() => {
                currentPosition = 50;
                updateScreen();
                winnerOverlay.style.display = 'none';
                isGameOver = false;
            }, 4000); 
        }
    </script>
</body>
</html>
